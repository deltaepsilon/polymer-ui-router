<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="polymer-ui-router-behavior.html">

<!--
`polymer-ui-router`
Polymer element for UI Router Core

@demo demo/index.html
-->

<dom-module id="polymer-ui-router">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
    </template>

    <script>
        (function(){


            Polymer({

                is: 'polymer-ui-router',
                behaviors: [
                    UIRouterBehavior
                ],
                properties: {
                    _routes: {
                        type: Array,
                        value: function () {
                            return [];
                        }
                    },
                    //exposing states just for demo purposes
                    states: {
                        type: Array,
                        value: function () {
                            return [];
                        },
                        notify: true
                    }
                },

                _showState: function (state) {
                    this.push('states', state);
                },

                attached: function () {
                    var registry = this.uiRouter.stateRegistry;
                    registry.get().forEach(this._showState.bind(this));
                    registry.onStatesChanged(function(event, states) {
                        if (event === 'registered') {
                            states.forEach(this._showState.bind(this))
                        };
                    }.bind(this));

                    var children = this.getEffectiveChildren('entries');
                    this._routes = children;

                    // load all route children
                    for (var x = 0; x < this._routes.length; x++) {
                        var route = this._routes[x];
                        var state = {
                            name: route.name,
                            url: route.url,
                            views: { $default: { template: route.template } },
                        };
                        registry.register(state);
                    }

                    this.start();
                },

                start: function () {
                    this.uiRouter.urlService.listen();
                    this.uiRouter.urlService.sync();
                }

            });

        })()
    </script>
</dom-module>
